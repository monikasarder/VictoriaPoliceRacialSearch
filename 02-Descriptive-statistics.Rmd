---
title: "Summary statistics search data"
author: "Monika Sarder"
date: "2024-09-16"
output: html_document
---

```{r setup, echo = FALSE, warning = FALSE, message=FALSE}
knitr::opts_chunk$set(results = "asis")

library(tidyverse)
library(plotly)
library(summarytools)
library(kableExtra)
library(magrittr)
library(rmarkdown)
library(forcats)
library(gmodels)
library(crosstable)
library(janitor)
library(DT)

dat <- readRDS("Output.data/Uniform.searches.with.hierarchy.RDS")

dat <- dat %>%
  filter(Unit.type == "Uniform",
         Contact.Type == "P")

```

## Variables of interest

Summary statistics for `r nrow(dat)` field contact reports submitted by uniform police following a person search without a warrant are summarised below.  


```{r summary 2, echo = FALSE, warning = FALSE}

of.interest <- c("Rank.of.Member",  "Area.type",  "Racial.appearance", "Gender","Search.type" ,"Found", "Year")

`VicPol station data` <- dat %>%
  select(all_of(of.interest))%>%
  mutate(across(everything(), ~ fct_infreq(.)))
  
print(dfSummary(`VicPol station data`, 
          max.distinct.values = 10, 
           varnumbers   = FALSE, 
                valid.col    = FALSE, 
                graph.magnif = 0.76),
      method = 'render')
```


## Finds by characteristics

An analysis of the hit-rate for features of interest appears below.
```{r Finds, echo=FALSE, warning=FALSE}

dat %>% 
  crosstable(c(Racial.appearance, Search.type, Gender, Year,  Area.type, Region), by=Found, total=TRUE, 
           test=TRUE, showNA='ifany', percent_digits=1) %>% 
  as_flextable()
```

## Missing race by characteristics

An analysis of the percentage with racial appearance data missing by chara

```{r Missing, echo=FALSE, warning=FALSE}

dat %>% 
  crosstable(c(Search.type, Year, Area.type, Region,Gender, Found), by=Racial.missing, total=TRUE, 
           test=TRUE, showNA='ifany', percent_digits=1) %>% 
  as_flextable()
```

## Hit rates by LGA

```{r LGA, echo=FALSE, warning=FALSE}



lga.racial <- dat %>%
  group_by(Area.type, Local.Government.Area, Racial.appearance)%>%
  summarise(Finds = sum(Found ==1, na.rm = T), Searches = n())%>%
  pivot_wider(names_from = Racial.appearance,
    values_from = c(Finds, Searches)
  )

datatable(lga.racial)
```
